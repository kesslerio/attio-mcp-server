#!/bin/bash

# pre-commit hook to prevent Claude Code and AI attribution messages
# Place this file in .git/hooks/pre-commit and make executable with: chmod +x .git/hooks/pre-commit

# Ensure the hook is being executed
echo "Pre-commit hook is running..."

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "üîç Checking for AI attribution messages in commit..."

# Get the commit message
commit_msg_file="$HOME/.git_commit_msg.txt"
if [ -f "$commit_msg_file" ]; then
  commit_msg=$(cat "$commit_msg_file")
else
  # Use the staging area commit message if available
  if [ -f ".git/COMMIT_EDITMSG" ]; then
    commit_msg=$(cat ".git/COMMIT_EDITMSG")
  else
    # Fallback to the last commit message (though this is less reliable)
    commit_msg=$(git log -1 --pretty=%B)
  fi
fi

# Check for attribution patterns ONLY in the commit message
# We're skipping file content check entirely as it causes issues
if [ -n "$commit_msg" ]; then
  if echo "$commit_msg" | grep -q "Generated with \[Claude Code\]"; then
    echo -e "${RED}Warning:${NC} Found AI attribution 'Generated with [Claude Code]'"
    echo -e "This will be automatically removed by the prepare-commit-msg hook."
    # Don't exit with error - let prepare-commit-msg handle this
  elif echo "$commit_msg" | grep -q "Co-Authored-By: Claude"; then
    echo -e "${RED}Warning:${NC} Found AI attribution 'Co-Authored-By: Claude'"
    echo -e "This will be automatically removed by the prepare-commit-msg hook."
    # Don't exit with error - let prepare-commit-msg handle this
  fi
fi

echo -e "${GREEN}‚úÖ Pre-commit hook completed successfully.${NC}"
exit 0