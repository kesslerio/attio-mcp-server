# Skip hooks in CI or when explicitly requested
[ "${CI:-}" = "true" ] && exit 0
[ "${SKIP_PREPUSH:-}" = "1" ] && exit 0

echo "🔍 Validating branch name..."
./build/validate_workflow.py --validate-branch || {
  echo "❌ Branch validation failed"
  exit 1
}

echo "🔍 Running TypeScript check..."
npm run typecheck || {
  echo "❌ TypeScript errors found"
  exit 1
}

echo "🔍 Running fast tests..."
if [ -n "${PREPUSH_TEST_CMD:-}" ]; then
  sh -lc "$PREPUSH_TEST_CMD"
else
  npm run test:offline:run --silent -- --reporter=dot --bail=1
fi || {
  echo "❌ Tests failed"
  exit 1
}

echo "✅ Pre-push validation complete"