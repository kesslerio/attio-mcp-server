# Skip hooks in CI or when explicitly requested
[ "${CI:-}" = "true" ] && exit 0
[ "${SKIP_PREPUSH:-}" = "1" ] && exit 0

echo "ğŸ” Validating branch name..."
./build/validate_workflow.py --validate-branch || {
  echo "âŒ Branch validation failed"
  exit 1
}

echo "ğŸ” Running TypeScript check..."
npm run typecheck || {
  echo "âŒ TypeScript errors found"
  exit 1
}

echo "ğŸ” Running fast tests..."
if [ -n "${PREPUSH_TEST_CMD:-}" ]; then
  sh -lc "$PREPUSH_TEST_CMD"
else
  npm run test:offline:run --silent -- --reporter=dot --bail=1
fi || {
  echo "âŒ Tests failed"
  exit 1
}

echo "âœ… Pre-push validation complete"